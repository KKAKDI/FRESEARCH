<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mabatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.fs.mapper.ResearchMapper">
	
	
	
	<select id="list" resultType="ResearchVO">
		<!--  
		select ctgr_nm, subj_nm, subj_regdate, subj_startdate, subj_enddate
		from category a, subject b
		where a.ctgr_code = b.ctgr_code
		
		<choose>
			<when test="research == '진행중설문'">
				<![CDATA[ and subj_enddate >= to_char(sysdate,'yy/mm/dd') ]]> 
			</when>
			<when test="research == '종료된설문'">
				<![CDATA[ and subj_enddate < to_char(sysdate,'yy/mm/dd') ]]> 
			</when>
		</choose>
		<![CDATA[    
           and rownum <= #{pageNum} * #{amount})
           where rn > (#{pageNum} -1) * #{amount}
        ]]>
		order by subj_enddate desc
		-->
	
	select ctgr_nm, subj_nm, subj_regdate, subj_startdate, subj_enddate
	from
		(
		select rownum rn, ctgr_nm, subj_nm, subj_regdate, subj_startdate, subj_enddate
		from v_research
		<![CDATA[ where rownum <= #{cri.pageNum} * #{cri.amount} ]]>
		<choose>
			<when test="research == '진행중설문'">
				<![CDATA[ and subj_enddate >= to_char(sysdate,'yy/mm/dd') ]]>
			</when>
			<when test="research == '종료된설문'">
				<![CDATA[ and subj_enddate < to_char(sysdate,'yy/mm/dd') ]]>
			</when>
		</choose>
		) 
	<![CDATA[ where rn > (#{cri.pageNum} -1) * #{cri.amount} ]]>
	
	</select>
	
	<select id="getCountBySubjCode" resultType="int">
		select count(subj_code) from subject
		<choose>
			<when test="research == '진행중설문'">
				<![CDATA[ where subj_enddate >= to_char(sysdate,'yy/mm/dd') ]]>
			</when>
			<when test="research == '종료된설문'">
				<![CDATA[ where subj_enddate < to_char(sysdate,'yy/mm/dd') ]]>
			</when>
		</choose>
	</select>
		
</mapper>